<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BluejayPro Attendance Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f8ff; color: #333; }
        .card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 700px;
            margin: auto;
            margin-bottom: 20px;
        }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: #fff; }
        form div { margin-bottom: 10px; }
        label { display: inline-block; width: 120px; }
        input[type="text"], input[type="url"], input[type="time"], input[type="password"], textarea, select {
            width: 200px;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #007bff;
            border: none;
            color: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .present { background-color: #d4edda; }
        .absent { background-color: #f8d7da; }
    </style>
</head>
<body>
<h1>BluejayPro Attendance Tracker</h1>

<div id="loginSection" class="card">
    <h2>Login</h2>
    <form id="loginForm">
        <div>
            <label for="loginUsername">Username:</label>
            <input type="text" id="loginUsername" required>
        </div>
        <div>
            <label for="loginPassword">Password:</label>
            <input type="password" id="loginPassword" required>
        </div>
        <button type="submit">Login</button>
    </form>
    <p>Don't have an account? <a href="#" id="showRegister">Register</a></p>
</div>

<div id="registerSection" class="card" style="display:none;">
    <h2>Register</h2>
    <form id="registerForm">
        <div>
            <label for="registerUsername">Username:</label>
            <input type="text" id="registerUsername" required>
        </div>
        <div>
            <label for="registerPassword">Password:</label>
            <input type="password" id="registerPassword" required>
        </div>
        <button type="submit">Sign Up</button>
    </form>
    <p><a href="#" id="showLogin">Back to Login</a></p>
</div>

<div id="attendanceSection" style="display:none;">
    <div class="card">
    <form id="attendanceForm">
        <div>
            <label for="employee">Employee:</label>
            <select id="employee" required></select>
        </div>
        <div>
            <label for="status">Status:</label>
            <select id="status" required>
                <option value="" disabled selected>Select status</option>
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
            </select>
        </div>
        <div>
            <label for="notes">Notes:</label>
            <textarea id="notes" rows="2" cols="30"></textarea>
        </div>
        <div>
            <label for="summary">Work Summary:</label>
            <input type="text" id="summary" required>
        </div>
        <div>
            <label for="excel">Excel File Link:</label>
            <input type="url" id="excel" required>
        </div>
        <div>
            <label for="timein">Time In:</label>
            <input type="time" id="timein" required>
        </div>
        <div>
            <label for="timeout">Time Out:</label>
            <input type="time" id="timeout" required>
        </div>
        <button type="submit">Add Entry</button>
        <button type="button" id="logoutBtn" style="float:right;">Logout</button>
    </form>
    </div>

    <div class="card">
    <table id="attendanceTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Employee</th>
                <th>Status</th>
                <th>Notes</th>
                <th>Work Summary</th>
                <th>Excel Link</th>
                <th>Time In</th>
                <th>Time Out</th>
            </tr>
        </thead>
        <tbody>
            <!-- entries will be added here -->
        </tbody>
    </table>
    </div>
</div>

<script>
// Keys for localStorage
const usersKey = 'users';
const recordsKey = 'attendanceRecords';

// Initialize users with hard-coded admin if not present
let users = JSON.parse(localStorage.getItem(usersKey)) || [];
if (!users.find(u => u.username === 'admin')) {
    users.push({username: 'admin', password: 'adminpass', role: 'admin'});
    localStorage.setItem(usersKey, JSON.stringify(users));
}

let currentUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;

const loginSection = document.getElementById('loginSection');
const registerSection = document.getElementById('registerSection');
const attendanceSection = document.getElementById('attendanceSection');
const attendanceForm = document.getElementById('attendanceForm');
const tableBody = document.querySelector('#attendanceTable tbody');
const employeeSelect = document.getElementById('employee');

// Utility to format date as YYYY-MM-DD HH:MM
function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day} ${hours}:${minutes}`;
}

// Convert 24h time to 12h AM/PM
function to12Hour(time24) {
    if (!time24) return '-';
    const [hourStr, minute] = time24.split(':');
    let hour = parseInt(hourStr, 10);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    hour = hour % 12;
    if (hour === 0) hour = 12;
    return `${hour}:${minute} ${ampm}`;
}

// Show the appropriate section based on login state
function updateView() {
    if (currentUser) {
        loginSection.style.display = 'none';
        registerSection.style.display = 'none';
        attendanceSection.style.display = 'block';
        populateEmployeeOptions();
        loadRecords();
    } else {
        loginSection.style.display = 'block';
        registerSection.style.display = 'none';
        attendanceSection.style.display = 'none';
    }
}

// Populate employee select; employees get only their name
function populateEmployeeOptions() {
    employeeSelect.innerHTML = '';
    if (currentUser.role === 'admin') {
        users.forEach(u => {
            if (u.role === 'employee') {
                const opt = document.createElement('option');
                opt.value = u.username;
                opt.textContent = u.username;
                employeeSelect.appendChild(opt);
            }
        });
    } else {
        const opt = document.createElement('option');
        opt.value = currentUser.username;
        opt.textContent = currentUser.username;
        employeeSelect.appendChild(opt);
        employeeSelect.disabled = true;
    }
}

// Add row to table based on a record object
function addRow(record) {
    const row = document.createElement('tr');
    if (record.status === 'Present') {
        row.classList.add('present');
    } else if (record.status === 'Absent') {
        row.classList.add('absent');
    }
    const cells = [
        formatDate(new Date(record.date)),
        record.employee,
        record.status,
        record.notes,
        record.summary,
        `<a href="${record.excel}" target="_blank">Excel File</a>`,
        to12Hour(record.timein),
        to12Hour(record.timeout)
    ];
    cells.forEach(html => {
        const td = document.createElement('td');
        td.innerHTML = html;
        row.appendChild(td);
    });
    tableBody.appendChild(row);
}

// Load records from storage and filter based on user
function loadRecords() {
    tableBody.innerHTML = '';
    const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
    const visible = currentUser.role === 'admin'
        ? records
        : records.filter(r => r.username === currentUser.username);
    visible.forEach(addRow);
}

// Registration handler
// Creates a new user object and stores it in localStorage
registerForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    if (users.find(u => u.username === username)) {
        alert('Username already exists');
        return;
    }
    users.push({username, password, role: 'employee'});
    localStorage.setItem(usersKey, JSON.stringify(users));
    alert('Registration successful! Please login.');
    registerForm.reset();
    showLogin();
});

function showLogin() {
    registerSection.style.display = 'none';
    loginSection.style.display = 'block';
}
function showRegisterForm() {
    loginSection.style.display = 'none';
    registerSection.style.display = 'block';
}

document.getElementById('showRegister').addEventListener('click', function(e) {
    e.preventDefault();
    showRegisterForm();
});

document.getElementById('showLogin').addEventListener('click', function(e) {
    e.preventDefault();
    showLogin();
});

// Login handler
// Verifies entered credentials against stored users
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    const user = users.find(u => u.username === username && u.password === password);
    if (!user) {
        alert('Invalid credentials');
        return;
    }
    currentUser = {username: user.username, role: user.role};
    localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
    updateView();
    loginForm.reset();
});

// Logout handler
document.getElementById('logoutBtn').addEventListener('click', function() {
    localStorage.removeItem('loggedInUser');
    currentUser = null;
    updateView();
});

// Handle attendance form submission
attendanceForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const employee = employeeSelect.value;
    const status = document.getElementById('status').value;
    const notes = document.getElementById('notes').value;
    const summary = document.getElementById('summary').value;
    const excel = document.getElementById('excel').value;
    const timein = document.getElementById('timein').value;
    const timeout = document.getElementById('timeout').value;

    const records = JSON.parse(localStorage.getItem(recordsKey)) || [];
    const record = {
        date: new Date().toISOString(),
        employee,
        status,
        notes,
        summary,
        excel,
        timein,
        timeout,
        username: currentUser.username
    };
    records.push(record);
    localStorage.setItem(recordsKey, JSON.stringify(records));

    addRow(record);
    attendanceForm.reset();
});

updateView();
</script>
</body>
</html>
